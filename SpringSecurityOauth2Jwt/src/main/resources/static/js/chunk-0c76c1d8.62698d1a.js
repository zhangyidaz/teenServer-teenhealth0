(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c76c1d8"],{"7ed9":function(t,e,i){"use strict";var a=i("8a2d"),r=i.n(a);r.a},"8a2d":function(t,e,i){},b1ca:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d2p-cropper-uploader",class:{"is-disabled":t.disabled}},[i("div",{staticClass:"image-list"},[t._l(t.list,(function(e,a){return i("div",{key:a,staticClass:"image-item"},[i("el-image",{staticClass:"image",attrs:{src:e.dataUrl?e.dataUrl:e.url,"data-src":e.url,"preview-src-list":t._urlList,fit:"contain"}}),t.disabled?t._e():i("div",{staticClass:"delete"},[i("i",{staticClass:"el-icon-delete",on:{click:function(i){return t.removeImage(a,e)}}})]),"uploading"===e.status?i("div",{staticClass:"status-uploading"},[i("el-progress",{attrs:{type:"circle",percentage:e.progress,width:70}})],1):"done"===e.status?i("div",{staticClass:"status-done"},[i("i",{staticClass:"el-icon-upload-success el-icon-check"})]):t._e()],1)})),t.limit<=0||t.limit>t.list.length?i("div",{staticClass:"image-item image-plus",on:{click:t.addNewImage}},[i("i",{staticClass:"el-icon-plus cropper-uploader-icon"})]):t._e()],2),i("d2p-cropper",{ref:"cropper",attrs:{title:t.title,cropperHeight:t.cropperHeight,dialogWidth:t.dialogWidth,accept:t.accept,uploadTip:t.uploadTip,maxSize:t.maxSize,cropper:t.cropper,output:"all"},on:{done:t.cropComplete}})],1)},r=[],s=(i("a434"),i("b0c0"),i("a9e3"),i("96cf"),i("1da1")),l=i("b85c"),n=i("53ca"),u=i("c80b"),o=i("0e05"),c=i("0e00"),p={name:"d2p-cropper-uploader",mixins:[c["a"].inputBase],components:{D2pCropper:u["default"]},props:{value:{type:[String,Array]},type:{type:String,default:"cos"},uploadTip:{type:String},title:String,cropperHeight:{type:[String,Number]},dialogWidth:{type:[String,Number],default:"50%"},maxSize:{type:Number,default:5},limit:{type:Number,default:1},accept:{type:String,default:".jpg, .jpeg, .png, .gif, .webp"},cropper:{type:Object},uploader:{type:Object},buildUrl:{type:Function,default:function(t,e){return"object"===Object(n["a"])(t)?e.url:t}}},data:function(){return{index:void 0,list:[]}},watch:{value:function(t){this.$emit("change",t),t!==this.emitValue&&this.initValue(t)}},created:function(){this.emitValue=this.value,this.initValue(this.value)},computed:{_urlList:function(){var t=[];if(this.list){var e,i=Object(l["a"])(this.list);try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push(a.url)}}catch(r){i.e(r)}finally{i.f()}}return t}},methods:{initValue:function(t){var e=[];if(null==t||""===t)return e;if("string"===typeof t)e.push({url:this.buildUrl(t),value:t,status:"done"});else{var i,a=Object(l["a"])(t);try{for(a.s();!(i=a.n()).done;){var r=i.value;e.push({url:this.buildUrl(r),value:r,status:"done"})}}catch(s){a.e(s)}finally{a.f()}}this.$set(this,"list",e)},addNewImage:function(){this.disabled||(this.index=void 0,this.$refs.cropper.clear(),this.$refs.cropper.open())},removeImage:function(t,e){this.list.splice(t,1),this.emit()},cropComplete:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var a,r,s,l,n,u,o,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=t.blob,r=t.dataUrl,s=t.file,l={url:void 0,dataUrl:r,status:"uploading",progress:0},n=function(t){l.progress=t.percent},u=function(t){l.status="error",l.message="文件上传出错:"+t.message,console.log(t)},console.log("blob:",a),o={file:a,fileName:s.name,onProgress:n,onError:u},e.list.push(l),i.next=11,e.doUpload(o);case 11:c=i.sent,l.url=e.buildUrl(c.url),l.value=c.url,l.status="done",e.emit();case 16:case"end":return i.stop()}}),i)})))()},doUpload:function(t){var e=this;return t.config=this.uploader,this.getUploader().then((function(i){return i.upload(t).then((function(t){return null!=e.suffix&&(t.url+=e.suffix),t}))}))},getUploader:function(){var t=this.type;return null!=this.uploader&&null!=this.uploader.type&&(t=this.uploader.type),o["a"].getUploader(t)},emit:function(){var t,e=[],i=Object(l["a"])(this.list);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(null!=a.status&&"done"!==a.status)return;"string"===typeof a?e.push(a):e.push(a.value)}}catch(s){i.e(s)}finally{i.f()}var r=e;1===this.limit&&(r=e&&e.length>0?e[0]:void 0),this.emitValue=r,this.$emit("input",r)}}},d=p,f=(i("7ed9"),i("2877")),h=Object(f["a"])(d,a,r,!1,null,null,null);e["default"]=h.exports}}]);