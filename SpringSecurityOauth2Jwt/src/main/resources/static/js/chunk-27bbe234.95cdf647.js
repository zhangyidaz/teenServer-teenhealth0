(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27bbe234","chunk-2d219f9b","chunk-2d22bd7e","chunk-2d0c2186"],{"499d":function(e,t,r){"use strict";r.r(t),r.d(t,"crudOptions",(function(){return n}));var n=function(e){return{options:{height:"100%"},rowHandle:{width:180,view:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("permission:role:view")}},edit:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("permission:role:edit")}},remove:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("permission:role:del")}},custom:[{thin:!0,text:null,type:"warning",size:"small",emit:"authz",icon:"el-icon-s-flag",disabled:function(){return!e.hasPermissions("permission:role:authz")}}]},columns:[{title:"id",key:"id",sortable:!0,width:100,form:{disabled:!0}},{title:"创建时间",key:"createTime",sortable:!0,type:"datetime",form:{disabled:!0}},{title:"更新时间",key:"updateTime",sortable:!0,type:"datetime",form:{disabled:!0}},{title:"角色名称",key:"name",sortable:!0},{title:"角色代码",key:"code",search:{disabled:!1},form:{editTemplateHandle:function(e){e.component.disabled=!0}},sortable:!0}]}}},"9e04":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("d2-container",{class:{"page-compact":e.crud.pageOptions.compact}},[r("template",{slot:"header"},[e._v("角色管理 "),r("example-helper",{attrs:{title:"权限管理帮助"}},[r("div",[r("h3",[e._v("如何启用权限管理，请点击下面帮助链接")]),r("link-button",{attrs:{href:"http://greper.gitee.io/d2-crud-plus/guide/permission.html"}},[e._v("权限管理帮助文档")])],1)])],1),r("d2-crud-x",e._g(e._b({ref:"d2Crud",attrs:{size:"mini"},on:{authz:e.authzHandle}},"d2-crud-x",e._crudProps,!1),e._crudListeners),[r("div",{staticClass:"d2-mb-5",attrs:{slot:"header"},slot:"header"}),r("div",{attrs:{slot:"header"},slot:"header"},[r("crud-search",{ref:"search",attrs:{options:e.crud.searchOptions},on:{submit:e.handleSearch}}),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"permission:role:add",expression:"'permission:role:add'"}],attrs:{size:"small",type:"primary"},on:{click:e.addRow}},[r("i",{staticClass:"el-icon-plus"}),e._v(" 新增")]),r("crud-toolbar",{attrs:{search:e.crud.searchOptions.show,compact:e.crud.pageOptions.compact,columns:e.crud.columns},on:{"update:search":function(t){return e.$set(e.crud.searchOptions,"show",t)},"update:compact":function(t){return e.$set(e.crud.pageOptions,"compact",t)},refresh:function(t){return e.doRefresh()},"columns-filter-changed":e.handleColumnsFilterChanged}})],1)]),r("el-dialog",{attrs:{title:"分配权限",visible:e.dialogPermissionVisible},on:{"update:visible":function(t){e.dialogPermissionVisible=t}}},[r("el-tree",{ref:"menuTree",staticClass:"filter-tree",attrs:{data:e.treeData,"default-checked-keys":e.checkedKeys,"check-strictly":!1,"node-key":"id","highlight-current":"",props:{label:"title",value:"id"},"show-checkbox":"","default-expand-all":""}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePermession(e.roleId)}}},[e._v("更 新 ")])],1)],1)],2)},i=[],s=(r("99af"),r("c975"),r("499d")),o=r("1fbf"),a=r("f163"),d=r("ba17"),u={name:"Role",mixins:[o["d2CrudPlus"].crud],data:function(){return{dsScopeData:[],treeData:[],checkedKeys:[],checkedDsScope:[],menuIds:"",list:[],listLoading:!0,form:{},roleId:void 0,rolesOptions:void 0,dialogPermissionVisible:!1}},methods:{getCrudOptions:function(){return Object(s["crudOptions"])(this)},pageRequest:function(e){return a["GetList"](e)},addRequest:function(e){return a["AddObj"](e)},updateRequest:function(e){return a["UpdateObj"](e)},delRequest:function(e){return a["DelObj"](e.id)},getAllCheckedLeafNodeId:function(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];i.children&&0!==i.children.length?this.getAllCheckedLeafNodeId(i.children,t,r):-1!==t.indexOf(i.id)&&r.push(i.id)}return r},authzHandle:function(e){var t=this;console.log("authz",e),d["GetTree"]().then((function(r){return t.$set(t,"treeData",r.data),t.$set(t,"checkedKeys",[]),t.roleId=e.row.id,t.updateChecked(e.row.id)})).then((function(){t.dialogPermissionVisible=!0}))},updateChecked:function(e){var t=this;return a["GetPermission"](e).then((function(e){var r=e.data;r=t.getAllCheckedLeafNodeId(t.treeData,r,[]),console.log("all leaf ",r),t.$set(t,"checkedKeys",r)}))},updatePermession:function(e){var t=this;this.menuIds=this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys()),a["DoAuthz"](e,this.menuIds).then((function(){t.dialogPermissionVisible=!1,t.updateChecked(e)}))}}},c=u,l=r("2877"),h=Object(l["a"])(c,n,i,!1,null,null,null);t["default"]=h.exports},ba17:function(e,t,r){"use strict";r.r(t),r.d(t,"GetList",(function(){return s})),r.d(t,"GetTree",(function(){return o})),r.d(t,"AddObj",(function(){return a})),r.d(t,"UpdateObj",(function(){return d})),r.d(t,"DelObj",(function(){return u})),r.d(t,"GetObj",(function(){return c}));var n=r("22ce"),i="/permission/manager/resource";function s(e){return Object(n["a"])({url:i+"/page",method:"get",params:e})}function o(e){return Object(n["a"])({url:i+"/tree",method:"get",params:e})}function a(e){return Object(n["a"])({url:i+"/add",method:"post",data:e})}function d(e){return Object(n["a"])({url:i+"/update",method:"post",data:e})}function u(e){return Object(n["a"])({url:i+"/delete",method:"post",params:{id:e}})}function c(e){return Object(n["a"])({url:i+"/info",method:"get",params:{id:e}})}},f163:function(e,t,r){"use strict";r.r(t),r.d(t,"GetList",(function(){return s})),r.d(t,"AddObj",(function(){return o})),r.d(t,"UpdateObj",(function(){return a})),r.d(t,"DelObj",(function(){return d})),r.d(t,"GetPermission",(function(){return u})),r.d(t,"DoAuthz",(function(){return c}));var n=r("22ce"),i="/permission/manager/role";function s(e){return Object(n["a"])({url:i+"/page",method:"get",params:e})}function o(e){return Object(n["a"])({url:i+"/add",method:"post",data:e})}function a(e){return Object(n["a"])({url:i+"/update",method:"post",data:e})}function d(e){return Object(n["a"])({url:i+"/delete",method:"post",params:{id:e}})}function u(e){return Object(n["a"])({url:i+"/getPermission",method:"get",params:{roleId:e}})}function c(e,t){return Object(n["a"])({url:i+"/authz",method:"post",params:{roleId:e},data:t})}}}]);